# basic.yaml
prerender:
  raster_size: 512
  scale: 3
  roadgraph_distillation_rate: 5
  center_x: 256
  center_y: 256

model:
  backbone: resnet34
  n_modes: 3
  n_timestamps: 80
  predict_covariances: true

training:
  # Epoch-level validation (метрики считаются после каждой эпохи)
  num_epochs: 60
  save_every_epochs: 1

  # TensorBoard
  tensorboard_logdir: runs/basic_2x4090
  log_every: 50

  # Speed / stability on 2x RTX4090
  amp: true
  amp_dtype: bf16          # bf16 рекомендуется для 4090
  accumulate_grad_batches: 1
  grad_clip_norm: 1.0

  optimizer:
    lr: 0.0003
    weight_decay: 0.0001
    betas: [0.9, 0.999]

  train_dataloader:
    batch_size: 64          # per GPU under DDP -> global batch = 128
    num_workers: 16
    shuffle: true
    pin_memory: true
    persistent_workers: true
    prefetch_factor: 4
    drop_last: true

  val_dataloader:
    batch_size: 64
    num_workers: 16
    shuffle: false
    pin_memory: true
    persistent_workers: true
    prefetch_factor: 4
    drop_last: false

  metrics:
    conf_threshold: 0.5
    dist_thresholds_m: [0.50, 0.55, 0.60, 0.65, 0.70, 0.75, 0.80, 0.85, 0.90, 0.95]
